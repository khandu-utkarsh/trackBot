components:
  schemas:
    MessageType:
      type: string
      enum:
        - user
        - assistant
        - system
      description: Type of message sender

    Message:
      type: object
      description: Represents a message in a conversation.
      required:
        - id
        - conversation_id
        - user_id
        - content
        - message_type
      properties:
        id:
          type: integer
          format: int64
          description: Unique identifier for the message.
          example: 1
          readOnly: true

        conversation_id:
          type: integer
          format: int64
          description: Conversation ID this message belongs to.
          example: 1

        user_id:
          type: integer
          format: int64
          description: User ID who sent the message.
          example: 1

        content:
          type: string
          description: Content of the message.
          example: "I want to start a new workout plan"

        message_type:
          $ref: '#/components/schemas/MessageType'

        created_at:
          type: string
          format: date-time
          description: Creation timestamp.
          example: "2024-01-15T10:30:00Z"
          readOnly: true

        additional_kwargs:
          type: object
          description: Additional metadata passed with the message.

        response_metadata:
          type: object
          description: Metadata returned by the model provider.
          example:
            model: gpt-4
            finish_reason: stop
            token_usage:
              prompt_tokens: 20
              completion_tokens: 50
              total_tokens: 70

        type:
          type: string
          enum: ["ai", "human"]
          description: Type of message.

        name:
          type: string
          nullable: true
          description: Optional name of the message sender/tool.

        llm_id:
          type: string
          description: Unique message ID from the model provider.
          example: "msg-abcdef"

        tool_calls:
          type: array
          items:
            type: object
          description: Tool calls made by the model in this message.

        invalid_tool_calls:
          type: array
          items:
            type: object
          description: Tool calls that failed to parse or execute.

        usage_metadata:
          type: object
          description: Token usage metadata.
          example:
            input_tokens: 24
            output_tokens: 60
            total_tokens: 84

        example:
          type: boolean
          description: Whether this message was part of an example conversation.
          default: false

      additionalProperties: false

    CreateMessageRequest:
      type: object
      description: Payload to create a new message.
      required:
        - content
        - message_type
      properties:
        content:
          type: string
          description: Content of the message.
          example: "I want to start a new workout plan"
        message_type:
          $ref: '#/components/schemas/MessageType'
      additionalProperties: false

    ListMessagesRequest:
      type: object
      properties:
        conversation_id:
          type: integer
          format: int64
        user_id:
          type: integer
          format: int64
        limit:
          type: integer
          minimum: 1
          maximum: 100
        offset:
          type: integer
          minimum: 0
      additionalProperties: false

    ListMessagesResponse:
      type: object
      description: Response containing a list of messages.
      required:
        - messages
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'
      additionalProperties: false

    LLMServiceMessageRequest:
      type: object
      description: Request to the LLM service to process a conversation.
      required:
        - messages
        - user_id
        - conversation_id
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'

        user_id:
          type: integer
          format: int64
          description: ID of the user making the request.
          example: 123

        conversation_id:
          type: integer
          format: int64
          description: ID of the conversation to which these messages belong.
          example: 456

      additionalProperties: false


    LLMServiceMessageResponse:
      type: object
      description: Response from the LLM service to process a conversation.
      required:
        - message
      properties:
        message:
          $ref: '#/components/schemas/Message'

        response_time_ms:
          type: integer
          format: int64
          description: Time taken to generate the response in milliseconds.
          example: 120

        model_name:
          type: string
          description: Identifier of the model used to generate the response.
          example: "gpt-4"

      additionalProperties: false
